import telebot
from telebot import types
import os

bot = telebot.TeleBot('TOKEN')  # Замените на свой токен

# Путь к папке с учебниками (замените на свой)
BOOKS_FOLDER = "textbooks/"


@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    bot.reply_to(
        message,
        "Привет! Я бот для поиска учебников по разным предметам. Просто напиши название предмета, и я попробую найти для тебя материалы."
    )


@bot.message_handler(content_types=['text'])
def handle_text(message):
    user_input = message.text.lower()

    if user_input == "привет":
        bot.send_message(
            message.chat.id,
            "Привет! Я бот для поиска учебников. Напиши название предмета, например: Алгебра, Физика и т.д."
        )

    elif user_input == "алгебра":
        # Создаем клавиатуру с выбором класса
        keyboard = types.InlineKeyboardMarkup()
        btn_7 = types.InlineKeyboardButton(text='7 класс', callback_data='algebra_7')
        btn_8 = types.InlineKeyboardButton(text='8 класс', callback_data='algebra_8')
        btn_9 = types.InlineKeyboardButton(text='9 класс', callback_data='algebra_9')
        keyboard.add(btn_7, btn_8, btn_9)

        bot.send_message(
            message.chat.id,
            "Вы выбрали Алгебру. Теперь укажите класс:",
            reply_markup=keyboard
        )

    else:
        bot.send_message(
            message.chat.id,
            f"Извините, учебников по предмету '{message.text}' пока нет в базе."
        )


@bot.callback_query_handler(func=lambda call: True)
def callback_inline(call):
    if call.data.startswith('algebra_'):
        class_num = call.data.split('_')[1]  # Получаем номер класса (7, 8, 9)

        # Формируем путь к файлу
        file_path = os.path.join(BOOKS_FOLDER, f"algebra_{class_num}.pdf")

        try:
            # Отправляем файл
            with open(file_path, 'rb') as file:
                bot.send_document(
                    call.message.chat.id,
                    file,
                    caption=f"Учебник по алгебре для {class_num} класса"
                )
        except FileNotFoundError:
            bot.send_message(
                call.message.chat.id,
                f"Извините, учебник для {class_num} класса временно недоступен."
            )
    else:
        bot.send_message(call.message.chat.id, "Неизвестная команда.")


bot.polling(none_stop=True)
